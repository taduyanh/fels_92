<% title "Start Lesson" %>

<div class="row">

  <h3> <%= @lesson.category.name %> </h3>
  <hr />
  <%= form_for @lesson do |f| %>
    <%= f.fields_for :lesson_words do |f_lesson_word| %>
      <% lesson_word = f_lesson_word.object %>
      <div class="answer_box" id="lesson_word_<%= lesson_word.id %>">
        <div class="col-xs-12 text-center" style="margin-bottom:40px">
          <strong>
            <%= @lesson_words.to_a.find_index(lesson_word) + 1 %>
            /
            <%= @lesson.question_length %>
          </strong>
        </div>

        <div class="col-md-6 col-xs-12 text-center">
          <p style="font-size:50px"><%= lesson_word.word.text_ja %></p>
        </div>

        

        <div class="col-md-6 col-xs-12 text-center answer-block">
          <% lesson_word.word.answers.each do |answer| %>
            <%= f_lesson_word.radio_button :answer_id, answer.id, class: "hidden"%>
            <%= f_lesson_word.label :answer_id, answer.text, 
                value: answer.id, class: "btn-answer btn btn-default btn-block", style: "margin-bottom:20px" %>
          <% end %>
        </div>
      </div>
    <% end %>

    <div class="button_block col-xs-12 text-center">
      <div class="col-xs-3">
        <button class="btn btn-success btn-block" id="prev-button" type="button">
            <%= t :prev %>
        </button>
      </div>

      <div class="col-xs-3 col-xs-offset-1">
        <%= f.submit t(:finish), data: {confirm: t(:finish_test_confirm)}, class: "btn btn btn-danger btn-block" %>
      </div>

      <div class="col-xs-3 col-xs-offset-1">
        <button class="btn btn-success btn-block" id="next-button" type="button">
            <%= t :next %>
        </button>
      </div>
    </div>
  <% end %>
  
<script type="text/javascript">
  var current_question = 0;
  var max_question = 19;
  $(function(){

    display_question();

    $('#prev-button').on('click', function() {
      current_question--;
      display_question();
    });

    $('#next-button').on('click', function() {
      current_question++;
      display_question();
    });


    $('.btn-answer').on('click', function() {
      if(current_question < max_question) {
        current_question++;
        display_question();
      }
    });
  });

  function display_question() {
    $(".answer_box").hide();
    $($(".answer_box")[current_question]).show();
    if(current_question === 0) {
      $('#prev-button').hide();
    } else {
      $('#prev-button').show();
    }

    if(current_question === 19) {
      $('#next-button').hide();
    } else {
      $('#next-button').show();
    }
  }
</script>